# 测试说明



## 3C

### TestPersist23C

5个服务器

重复五次,日志从11-25

首先共识日志11，

找出Leader S1，将其后两个服务器S2,S3断连

然后3个服务器共识日志12

断连包括Leadere在内的3个服务器S1,S4,S5。重启前两个断连的服务器S2,S3.

选举时间超时

重启S4,3个服务器S2,S3,S4对日志13进行公式

重启S1与S5。

### TestFigure8Unreliable3C

5个服务器

首先增添一条日志0-9999

重复一千次，在第200次后，包达到顺序开始混乱

    找到Leader，并增添一条日志

    9/10的概率睡0-13ms，1/10的概率睡0-500ms

    如果当前有Leader，1/2概率将Leader断连

    如果网络中的服务器数量小于<3，尝试重新将一台服务器加进网络（不一定都加进来）

所有成员共识一条日志0-9999

## 3D

快照间隔=10个日志触发一次快照，每个节点日志持久化后的大小不允许大于2000字节。

### TestSnapshotBasic3D

3 个服务器，可靠的网络环境，无断连，无raft节点crash。

首先共识一条随机数的日志，

重复30次的循环，3次一个循环。

<!-- 其中两次受害者是leader+1，加害者是leader。一次受害者是leader，加害者是leader+1 -->

每次循环，Leader添加5-15个日志条目,然后共识一条随机数日志。(6-16)

在此期间，每apply10个日志条目，触发一次snapshot.
(在apply的时候不能有锁，因为applyCh是一个无缓冲的管道)

### TestSnapshotInstallCrash3D

3 个服务器，可靠的网络环境，无断连，存在raft节点crash。

首先共识一条随机数的日志，

重复30次的循环，3次一个循环。

其中两次受害者是leader+1，加害者是leader。一次受害者是leader，加害者是leader+1。

受害者节点crash。

Leader添加5-15个日志条目,然后共识一条随机数日志。

恢复受害者节点，并共识一条随机数日志。